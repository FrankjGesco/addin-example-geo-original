"use strict";geotab.addin.tripsTimeline=function(){var i,r,u,a=document.getElementById("tripstimeline-chart-container"),o=document.getElementById("tripstimeline-chart-prev"),c=document.getElementById("tripstimeline-chart-next"),d=new Date,s=new Date,l=144e5,f=[],v={},m=!1,g=!1,h=null,p=function(t,e){var n,r;(n=t,r=e,new Promise(function(t){i.call("Get",{typeName:"Trip",search:{fromDate:n.toISOString(),toDate:r.toISOString()},resultsLimit:1e4},t)}).catch(function(t){return alert(t),[]})).then(function(t){var e,n,r,i,a,o;for(r=0;r<t.length;r++)e=t[r],(n=m[e.device.id])&&!v[e.id]&&(v[e.id]=!0,i=new Date(e.start),a=new Date(e.stop),f.push({id:e.id,content:(o=n.name,o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")+"<br>"+O(i,a)+y(i,a,n)),start:i,end:a}));u.setItems(f),u.redraw()})},w=function(t){if(u){var e=u.getWindow(),n=e.end-e.start;u.setWindow({start:e.start.valueOf()+t*n*.5,end:e.end.valueOf()+t*n*.5})}},D=function(){a.style.width=a.parentNode.offsetWidth-o.offsetWidth-c.offsetWidth-20+"px"},I=function(){return m?(f=[],v={},d=new Date(u.range.start-l),s=new Date(u.range.start+l),D(),p(d,s),!0):(t(),!(g=!0))},t=function(){return i.call("Get",{typeName:"Device",resultsLimit:1e3,search:{groups:r.getGroupFilter?r.getGroupFilter():[{id:"GroupCompanyId"}],fromDate:(new Date).toISOString}},function(t){var e,n={};for(e=0;e<t.length;e++)n[t[e].id]=t[e];m=n,g&&(I(),g=!1)},function(t){alert(t)}),!1},n=function(t){var e=""+t.getHours(),n=""+t.getMinutes();return 1===e.length&&(e="0"+e),1===n.length&&(n="0"+n),e+":"+n},O=function(t,e){return n(t)+" - "+n(e)},y=function(t,e,n){return"<a href=\"#tripsHistory,dateRange:(endDate:'' + end.toISOString() + '',startDate:'' + start.toISOString() + ''),devices:!(".concat(n.id,')" class="geotabButtonIcons externalLink detailslink" target="_blank"></a>')};return{initialize:function(t,e,n){i=t,r=e,function(){(u=new vis.Timeline(a,[],{orientation:"top",zoomMin:144e5,zoomMax:144e5,minHeight:180})).on("rangechange",function(t){var e;t.start.valueOf()-d.valueOf()<72e5&&(e=d,d=new Date(d.valueOf()-l),p(d,e)),s.valueOf()-t.end.valueOf()<72e5&&(e=s,s=new Date(s.valueOf()+l),p(d,e))});var t=function(){h||(w(-1),h=window.setInterval(function(){w(-1)},200))},e=function(){h||(w(1),h=window.setInterval(function(){w(1)},200))},n=function(){h&&(window.clearInterval(h),h=null)},r=function(){var e=!0;try{document.createEvent("TouchEvent")}catch(t){e=!1}return e}();r?o.addEventListener("touchstart",t,!1):o.addEventListener("mousedown",t,!1),r?c.addEventListener("touchstart",e,!1):c.addEventListener("mousedown",e,!1),document.body.addEventListener("mouseup",n,!1),r&&document.body.addEventListener("touchend",n,!1),D()}(),n&&n()},focus:function(t,e){i=t,r=e,m=!1,I()},blur:function(){f=[],m=!(v={})}}};